(function() {
  var StorageRouter;

  StorageRouter = (function() {
    function StorageRouter() {}

    StorageRouter.route = function(query, callback) {
      var db, _ref;
      query.graph.debug('StorageRouter> CRUD:', {
        action: query.action,
        schema: query.current_router.configuration,
        data: query.data,
        search: query.search_query
      });
      db = query.graph.storage_manager.database;
      query.schema = query.current_router.configuration;
      if (query.data && (typeof query.data === 'string')) {
        query.data = JSON.parse(query.data);
      }
      if ((_ref = query.action) === 'create' || _ref === 'read' || _ref === 'update' || _ref === 'delete') {
        return db[query.action](query, function(result) {
          query.data = result;
          return callback(query);
        });
      } else {
        return callback(null);
      }
    };

    return StorageRouter;

  })();

  module.exports = StorageRouter;

}).call(this);
